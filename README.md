# Ukrainian NER + Presidio Demo

Українська система виявлення та анонімізації персональних даних, побудована на базі трансформерної NER-моделі та rule-based розпізнавачів Microsoft Presidio. Проєкт постачається з веб-демо на Gradio для швидкого тестування та демонстрації.

## Можливості
- Використовує Hugging Face модель `dchaplinsky/uk_ner_web_trf_13class` для розпізнавання українських сутностей (персоналії, організації, документи тощо).
- Додає Presidio pattern recognizers для типових PII: email, телефони, IBAN, банківські карти, IP, URL, криптогаманці й часові мітки.
- Анонімізує виявлені сутності за допомогою Presidio Anonymizer з кастомним форматуванням (`[ENTITY]`).
- Підтримує спеціалізований IBAN-патерн для українського формату `UA` + 27 цифр.
- Легкий деплой: Presidio запускається із `NoOpNlpEngine`, тому великий англомовний spaCy-пайплайн не завантажується.

## Як це працює
1. **Завантаження моделі**: під час першого запуску Hugging Face кешує ваги української NER-моделі.
2. **NER-аналіз**: spaCy обробляє текст і повертає сутності з українськими label’ами.
3. **Rule-based аналіз**: Presidio Analyzer з `NoOpNlpEngine` застосовує патерни до заданих PII сутностей.
4. **Узгодження**: система видаляє перетини між результатами, віддаючи пріоритет розпізнаванням з вищим score.
5. **Анонімізація**: Presidio Anonymizer замінює фрагменти тексту маркерами у форматі `[ENTITY]`.
6. **Gradio UI**: користувацький інтерфейс показує знайдені сутності та анонімізований текст.

## Встановлення
1. Потрібен Python 3.9 або новіший та віртуальне оточення (`venv`, `conda`, `poetry` тощо).
2. Клонувати репозиторій і перейти до нього.
3. Створити й активувати віртуальне середовище. Наприклад:

```bash
python3 -m venv .venv
source .venv/bin/activate
```

4. Встановити залежності:

```bash
pip install -r requirements.txt
```

> **Примітка.** Пакет `urllib3` може показувати попередження щодо LibreSSL на macOS. На роботу застосунку це не впливає.

## Запуск демо

```bash
python app.py
```

Gradio виведе локальний URL (наприклад, `http://127.0.0.1:7860`). Відкрийте його у браузері, вставте український текст і натисніть **Submit**. Результати відобразяться в двох панелях: знайдені сутності та анонімізований текст.

## Які сутності підтримуються

**Українська NER модель:** `PERS`, `ORG`, `LOC`, `DATE`, `TIME`, `JOB`, `MON`, `PCT`, `PERIOD`, `DOC`, `QUANT`, `ART`, `MISC`.

**Presidio патерни:** `EMAIL_ADDRESS`, `PHONE_NUMBER`, `CREDIT_CARD`, `IBAN_CODE`, `IP_ADDRESS`, `URL`, `CRYPTO`, `DATE_TIME`.

За замовчуванням усі сутності анонімізуються за допомогою операторів типу `replace`. Формат заміни можна змінити в `app.py`, редагуючи словник `operators`.

## Налаштування та розширення
- **Додавання нових правил**: створіть `Pattern`/`PatternRecognizer` і зареєструйте його через `presidio_analyzer.registry.add_recognizer(...)`.
- **Інша стратегія анонімізації**: змініть `OperatorConfig`, наприклад, на `mask` чи `hash`.
- **Робота офлайн**: після першого запуску модель spaCy кешується в каталозі Hugging Face (`~/.cache/huggingface`).
- **Деплой**: Gradio можна запустити в `server_name="0.0.0.0"` і додати `share=True` для швидкого шарінгу.

## Поширені питання
- **Чому Presidio вимагає англомовну модель?** У базовій конфігурації Presidio підтягує `en_core_web_lg`. У цьому проєкті використовується `NoOpNlpEngine`, тому додаткові ресурси не завантажуються.
- **Що робити, якщо Hugging Face вимагає авторизацію?** Увійдіть за допомогою `huggingface-cli login` і повторіть запуск.
- **Чи можна запустити без GPU?** Так, модель працює на CPU, хоча inference буде повільнішим.

## Структура проєкту

```
├── app.py            # Головний застосунок із Gradio інтерфейсом
├── requirements.txt  # Python-залежності
├── flagged/          # Стандартна директорія Gradio для збереження flagged-випадків
└── README.md         # Ця документація
```

## Ліцензія та авторство

Це демо створено для експериментів з українськими PII/NER сценаріями. Уточнюйте ліцензії моделей та бібліотек (Hugging Face model, spaCy, Presidio) перед продакшен-використанням.
